# Excelæ•ˆç‡åŠ©æ‰‹ Pro - VSTOæŠ€æœ¯æ¶æ„è®¾è®¡

## ğŸ“ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Excel Application                  â”‚
â”‚                    (COM Interface)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              VSTO Add-in (C# .NET)                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚           Ribbon UI (åŠŸèƒ½åŒºç•Œé¢)                  â”‚ â”‚
â”‚ â”‚  [æ•°æ®åŒ¹é…] [ä¸€é”®ç¾åŒ–] [æ–‡æœ¬å¤„ç†] [æ–°æ‰‹æŒ‡å—]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Task Pane      â”‚  Dialog      â”‚  Wizard        â”‚ â”‚
â”‚ â”‚  (ä»»åŠ¡çª—æ ¼)      â”‚  (å¯¹è¯æ¡†)     â”‚  (å‘å¯¼çª—ä½“)     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚              Business Logic Layer                 â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚  â”‚ DataMatcher â”‚ Beautifier â”‚ TextProcessor   â”‚ â”‚ â”‚
â”‚ â”‚  â”‚ (æ•°æ®åŒ¹é…å™¨) â”‚ (ç¾åŒ–å¼•æ“)  â”‚ (æ–‡æœ¬å¤„ç†å™¨)     â”‚ â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚               Core Services Layer                 â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚  â”‚ Settings â”‚ Template â”‚ History  â”‚ Helper   â”‚ â”‚ â”‚
â”‚ â”‚  â”‚ Manager  â”‚ Manager  â”‚ Manager  â”‚ Utilitiesâ”‚ â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                 Data Layer                        â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚ â”‚  â”‚ SQLite Database  â”‚  XML Config Files        â”‚â”‚ â”‚
â”‚ â”‚  â”‚ (ç”¨æˆ·æ•°æ®/é…ç½®)   â”‚  (æ¨¡æ¿/é¢„è®¾)              â”‚â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. æ•°æ®åŒ¹é…å¼•æ“ (DataMatcher)

```csharp
namespace ExcelEfficiencyAssistant.Core
{
    /// <summary>
    /// æ•°æ®åŒ¹é…æ ¸å¿ƒå¼•æ“
    /// </summary>
    public class DataMatcherEngine
    {
        /// <summary>
        /// æ™ºèƒ½æ•°æ®åŒ¹é…ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰
        /// </summary>
        public MatchResult SmartMatch(Excel.Range targetRange)
        {
            // 1. åˆ†æç›®æ ‡åŒºåŸŸ
            var analysis = AnalyzeRange(targetRange);

            // 2. æ™ºèƒ½è¯†åˆ«ä¸»é”®åˆ—
            var keyColumn = DetectKeyColumn(analysis);

            // 3. æ‰«æå·¥ä½œç°¿æŸ¥æ‰¾åŒ¹é…æº
            var sources = FindMatchingSources(keyColumn);

            // 4. æ™ºèƒ½æ¨èåŒ¹é…æ–¹æ¡ˆ
            var suggestions = GenerateMatchSuggestions(sources);

            // 5. ç”¨æˆ·ç¡®è®¤åæ‰§è¡ŒåŒ¹é…
            if (UserConfirms(suggestions))
            {
                return ExecuteMatch(suggestions);
            }

            return null;
        }

        /// <summary>
        /// VLOOKUPå‘å¯¼åŒ¹é…
        /// </summary>
        public MatchResult WizardMatch(MatchConfig config)
        {
            // éªŒè¯é…ç½®
            if (!ValidateConfig(config))
                throw new ArgumentException("é…ç½®æ— æ•ˆ");

            // æ„å»ºåŒ¹é…ç´¢å¼•ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
            var index = BuildMatchIndex(config.SourceRange, config.KeyColumn);

            // æ‰¹é‡åŒ¹é…ï¼ˆä½¿ç”¨æ•°ç»„æ“ä½œï¼‰
            var results = BatchMatch(config.TargetRange, index, config.ReturnColumns);

            // å†™å…¥ç»“æœ
            WriteResults(config.TargetRange, results);

            return new MatchResult
            {
                MatchedCount = results.MatchedCount,
                UnmatchedCount = results.UnmatchedCount,
                Duration = results.Duration
            };
        }

        /// <summary>
        /// æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨å­—å…¸ç´¢å¼•
        /// </summary>
        private Dictionary<string, object[]> BuildMatchIndex(
            Excel.Range sourceRange,
            int keyColumnIndex)
        {
            var index = new Dictionary<string, object[]>();
            object[,] data = sourceRange.Value2;

            for (int row = 2; row <= data.GetLength(0); row++)
            {
                string key = data[row, keyColumnIndex]?.ToString();
                if (!string.IsNullOrEmpty(key) && !index.ContainsKey(key))
                {
                    index[key] = GetRowData(data, row);
                }
            }

            return index;
        }

        /// <summary>
        /// æ‰¹é‡åŒ¹é…ï¼ˆæ•°ç»„æ“ä½œï¼Œæ€§èƒ½ä¼˜å¼‚ï¼‰
        /// </summary>
        private BatchMatchResult BatchMatch(
            Excel.Range targetRange,
            Dictionary<string, object[]> index,
            int[] returnColumns)
        {
            object[,] targetData = targetRange.Value2;
            int rowCount = targetData.GetLength(0);
            int colCount = returnColumns.Length;

            object[,] results = new object[rowCount, colCount];
            int matchedCount = 0;

            Parallel.For(1, rowCount + 1, row =>
            {
                string key = targetData[row, 1]?.ToString();

                if (!string.IsNullOrEmpty(key) && index.ContainsKey(key))
                {
                    var sourceRow = index[key];
                    for (int col = 0; col < colCount; col++)
                    {
                        results[row - 1, col] = sourceRow[returnColumns[col]];
                    }
                    Interlocked.Increment(ref matchedCount);
                }
            });

            return new BatchMatchResult
            {
                Data = results,
                MatchedCount = matchedCount,
                UnmatchedCount = rowCount - matchedCount
            };
        }
    }

    /// <summary>
    /// æ™ºèƒ½åˆ—æ£€æµ‹
    /// </summary>
    public class SmartColumnDetector
    {
        public ColumnInfo DetectKeyColumn(Excel.Range range)
        {
            var candidates = new List<ColumnCandidate>();
            object[,] data = range.Value2;

            for (int col = 1; col <= data.GetLength(1); col++)
            {
                var score = CalculateKeyScore(data, col);
                candidates.Add(new ColumnCandidate
                {
                    ColumnIndex = col,
                    ColumnName = data[1, col]?.ToString(),
                    Score = score
                });
            }

            // è¿”å›å¾—åˆ†æœ€é«˜çš„åˆ—
            return candidates.OrderByDescending(c => c.Score).First();
        }

        private int CalculateKeyScore(object[,] data, int colIndex)
        {
            int score = 0;

            // æ£€æŸ¥åˆ—åï¼ˆIDã€ç¼–å·ã€åºå·ç­‰å…³é”®è¯åŠ åˆ†ï¼‰
            string colName = data[1, colIndex]?.ToString()?.ToLower();
            if (colName?.Contains("id") == true) score += 50;
            if (colName?.Contains("ç¼–å·") == true) score += 50;
            if (colName?.Contains("åºå·") == true) score += 30;

            // æ£€æŸ¥å”¯ä¸€æ€§
            var uniqueValues = new HashSet<string>();
            for (int row = 2; row <= data.GetLength(0); row++)
            {
                uniqueValues.Add(data[row, colIndex]?.ToString());
            }

            int totalRows = data.GetLength(0) - 1;
            double uniqueRatio = (double)uniqueValues.Count / totalRows;
            score += (int)(uniqueRatio * 50);

            return score;
        }
    }
}
```

### 2. è¡¨æ ¼ç¾åŒ–å¼•æ“ (Beautifier)

```csharp
namespace ExcelEfficiencyAssistant.Core
{
    /// <summary>
    /// è¡¨æ ¼ç¾åŒ–å¼•æ“
    /// </summary>
    public class TableBeautifier
    {
        private TemplateManager templateManager;

        public TableBeautifier()
        {
            templateManager = new TemplateManager();
        }

        /// <summary>
        /// æ™ºèƒ½ç¾åŒ–ï¼ˆè‡ªåŠ¨è¯†åˆ«è¡¨æ ¼ç±»å‹ï¼‰
        /// </summary>
        public void SmartBeautify(Excel.Range range)
        {
            // åˆ†æè¡¨æ ¼ç±»å‹
            var tableType = AnalyzeTableType(range);

            // é€‰æ‹©åˆé€‚çš„æ¨¡æ¿
            var template = templateManager.GetTemplateForType(tableType);

            // åº”ç”¨æ¨¡æ¿
            ApplyTemplate(range, template);
        }

        /// <summary>
        /// åº”ç”¨æŒ‡å®šæ¨¡æ¿
        /// </summary>
        public void ApplyTemplate(Excel.Range range, BeautifyTemplate template)
        {
            // ç¦ç”¨å±å¹•æ›´æ–°ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
            Excel.Application app = range.Application;
            app.ScreenUpdating = false;

            try
            {
                // 1. æ ‡é¢˜è¡Œç¾åŒ–
                if (template.HeaderStyle != null)
                {
                    ApplyHeaderStyle(range.Rows[1], template.HeaderStyle);
                }

                // 2. æ•°æ®è¡Œç¾åŒ–ï¼ˆæ–‘é©¬çº¹ï¼‰
                if (template.AlternateRowColors)
                {
                    ApplyAlternateRowColors(range, template.Color1, template.Color2);
                }

                // 3. è¾¹æ¡†æ ·å¼
                ApplyBorders(range, template.BorderStyle);

                // 4. å­—ä½“è®¾ç½®
                range.Font.Name = template.FontName;
                range.Font.Size = template.FontSize;

                // 5. åˆ—å®½è‡ªé€‚åº”
                if (template.AutoFitColumns)
                {
                    range.Columns.AutoFit();
                }

                // 6. æ•°å­—æ ¼å¼åŒ–
                ApplyNumberFormat(range, template);

                // 7. å†»ç»“é¦–è¡Œ
                if (template.FreezePanes)
                {
                    range.Worksheet.Application.ActiveWindow.SplitRow = 1;
                    range.Worksheet.Application.ActiveWindow.FreezePanes = true;
                }

                // 8. æ·»åŠ ç­›é€‰
                if (template.AddAutoFilter)
                {
                    range.AutoFilter(1);
                }
            }
            finally
            {
                app.ScreenUpdating = true;
            }
        }

        /// <summary>
        /// æ ‡é¢˜è¡Œæ ·å¼
        /// </summary>
        private void ApplyHeaderStyle(Excel.Range headerRow, HeaderStyle style)
        {
            headerRow.Font.Bold = true;
            headerRow.Font.Size = style.FontSize;
            headerRow.Interior.Color = ColorTranslator.ToOle(style.BackColor);
            headerRow.Font.Color = ColorTranslator.ToOle(style.ForeColor);
            headerRow.VerticalAlignment = Excel.XlVAlign.xlVAlignCenter;
            headerRow.RowHeight = style.RowHeight;
        }

        /// <summary>
        /// éš”è¡Œæ¢è‰²
        /// </summary>
        private void ApplyAlternateRowColors(
            Excel.Range range,
            Color color1,
            Color color2)
        {
            for (int i = 2; i <= range.Rows.Count; i++)
            {
                var row = range.Rows[i];
                row.Interior.Color = ColorTranslator.ToOle(
                    i % 2 == 0 ? color1 : color2);
            }
        }

        /// <summary>
        /// åˆ†æè¡¨æ ¼ç±»å‹
        /// </summary>
        private TableType AnalyzeTableType(Excel.Range range)
        {
            object[,] data = range.Value2;

            // æ£€æµ‹è´¢åŠ¡è¡¨æ ¼
            if (HasMoneyColumn(data) && HasTotalRow(data))
                return TableType.Financial;

            // æ£€æµ‹æ—¥æœŸåºåˆ—è¡¨
            if (HasDateColumn(data))
                return TableType.TimeSeries;

            // æ£€æµ‹å®½è¡¨æ ¼ï¼ˆåˆ—å¤šè¡Œå°‘ï¼‰
            if (data.GetLength(1) > data.GetLength(0))
                return TableType.Comparison;

            return TableType.General;
        }
    }

    /// <summary>
    /// ç¾åŒ–æ¨¡æ¿
    /// </summary>
    public class BeautifyTemplate
    {
        public string Name { get; set; }
        public string DisplayName { get; set; }
        public string Category { get; set; }
        public byte[] PreviewImage { get; set; }

        // æ ‡é¢˜è¡Œæ ·å¼
        public HeaderStyle HeaderStyle { get; set; }

        // é¢œè‰²æ–¹æ¡ˆ
        public bool AlternateRowColors { get; set; }
        public Color Color1 { get; set; }
        public Color Color2 { get; set; }

        // è¾¹æ¡†æ ·å¼
        public BorderStyle BorderStyle { get; set; }

        // å­—ä½“è®¾ç½®
        public string FontName { get; set; }
        public int FontSize { get; set; }

        // å…¶ä»–é€‰é¡¹
        public bool AutoFitColumns { get; set; }
        public bool FreezePanes { get; set; }
        public bool AddAutoFilter { get; set; }

        // æ•°å­—æ ¼å¼
        public Dictionary<int, string> NumberFormats { get; set; }
    }
}
```

### 3. æ–‡æœ¬å¤„ç†å™¨ (TextProcessor)

```csharp
namespace ExcelEfficiencyAssistant.Core
{
    /// <summary>
    /// æ–‡æœ¬å¤„ç†å¼•æ“
    /// </summary>
    public class TextProcessor
    {
        /// <summary>
        /// æ‰¹é‡æ–‡æœ¬è½¬æ¢
        /// </summary>
        public void BatchTransform(
            Excel.Range range,
            TextTransformType type)
        {
            object[,] data = range.Value2;
            object[,] results = new object[data.GetLength(0), data.GetLength(1)];

            Parallel.For(1, data.GetLength(0) + 1, row =>
            {
                for (int col = 1; col <= data.GetLength(1); col++)
                {
                    string value = data[row, col]?.ToString();
                    if (!string.IsNullOrEmpty(value))
                    {
                        results[row - 1, col - 1] = Transform(value, type);
                    }
                }
            });

            range.Value2 = results;
        }

        /// <summary>
        /// æ–‡æœ¬è½¬æ¢
        /// </summary>
        private string Transform(string text, TextTransformType type)
        {
            switch (type)
            {
                case TextTransformType.ToUpper:
                    return text.ToUpper();

                case TextTransformType.ToLower:
                    return text.ToLower();

                case TextTransformType.ToProper:
                    return CultureInfo.CurrentCulture.TextInfo.ToTitleCase(text.ToLower());

                case TextTransformType.TrimSpaces:
                    return text.Trim();

                case TextTransformType.RemoveAllSpaces:
                    return Regex.Replace(text, @"\s+", "");

                case TextTransformType.ExtractNumbers:
                    return Regex.Match(text, @"\d+").Value;

                case TextTransformType.ExtractLetters:
                    return Regex.Replace(text, @"[^a-zA-Z]", "");

                case TextTransformType.ExtractEmail:
                    var emailMatch = Regex.Match(text,
                        @"\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b");
                    return emailMatch.Success ? emailMatch.Value : "";

                case TextTransformType.ExtractPhone:
                    var phoneMatch = Regex.Match(text,
                        @"1[3-9]\d{9}");
                    return phoneMatch.Success ? phoneMatch.Value : "";

                default:
                    return text;
            }
        }

        /// <summary>
        /// æ™ºèƒ½æ‹†åˆ†åˆ—
        /// </summary>
        public void SmartSplitColumn(Excel.Range range, string delimiter = null)
        {
            // å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ†éš”ç¬¦ï¼Œè‡ªåŠ¨æ£€æµ‹
            if (string.IsNullOrEmpty(delimiter))
            {
                delimiter = DetectDelimiter(range);
            }

            object[,] data = range.Value2;
            List<string[]> splitResults = new List<string[]>();
            int maxColumns = 0;

            // æ‹†åˆ†æ•°æ®
            for (int row = 1; row <= data.GetLength(0); row++)
            {
                string value = data[row, 1]?.ToString();
                if (!string.IsNullOrEmpty(value))
                {
                    var parts = value.Split(new[] { delimiter },
                        StringSplitOptions.None);
                    splitResults.Add(parts);
                    maxColumns = Math.Max(maxColumns, parts.Length);
                }
            }

            // å†™å…¥ç»“æœ
            Excel.Range targetRange = range.Offset[0, 1].Resize[range.Rows.Count, maxColumns];
            object[,] results = new object[splitResults.Count, maxColumns];

            for (int i = 0; i < splitResults.Count; i++)
            {
                for (int j = 0; j < splitResults[i].Length; j++)
                {
                    results[i, j] = splitResults[i][j];
                }
            }

            targetRange.Value2 = results;
        }

        /// <summary>
        /// è‡ªåŠ¨æ£€æµ‹åˆ†éš”ç¬¦
        /// </summary>
        private string DetectDelimiter(Excel.Range range)
        {
            var delimiters = new[] { ",", ";", "\t", "|", " " };
            var counts = new Dictionary<string, int>();

            object[,] data = range.Value2;
            string sampleText = string.Join("",
                Enumerable.Range(1, Math.Min(10, data.GetLength(0)))
                    .Select(i => data[i, 1]?.ToString()));

            foreach (var delimiter in delimiters)
            {
                counts[delimiter] = sampleText.Split(new[] { delimiter },
                    StringSplitOptions.None).Length - 1;
            }

            return counts.OrderByDescending(kv => kv.Value).First().Key;
        }

        /// <summary>
        /// æ‰¹é‡æ›¿æ¢
        /// </summary>
        public ReplaceResult BatchReplace(
            Excel.Range range,
            string findText,
            string replaceText,
            ReplaceOptions options)
        {
            int count = 0;
            object[,] data = range.Value2;

            for (int row = 1; row <= data.GetLength(0); row++)
            {
                for (int col = 1; col <= data.GetLength(1); col++)
                {
                    string value = data[row, col]?.ToString();
                    if (!string.IsNullOrEmpty(value))
                    {
                        string newValue = Replace(value, findText, replaceText, options);
                        if (newValue != value)
                        {
                            data[row, col] = newValue;
                            count++;
                        }
                    }
                }
            }

            range.Value2 = data;

            return new ReplaceResult
            {
                ReplacedCount = count,
                Success = true
            };
        }
    }
}
```

## ğŸ¨ UIç»„ä»¶è®¾è®¡

### 1. Ribbonç•Œé¢

```xml
<customUI xmlns="http://schemas.microsoft.com/office/2009/07/customui">
  <ribbon>
    <tabs>
      <tab id="EfficiencyTab" label="æ•ˆç‡åŠ©æ‰‹">

        <!-- æ•°æ®åŒ¹é…ç»„ -->
        <group id="DataMatchGroup" label="æ•°æ®åŒ¹é…">
          <button id="SmartMatchBtn"
                  label="æ™ºèƒ½åŒ¹é…"
                  size="large"
                  image="SmartMatch"
                  onAction="OnSmartMatch"
                  screentip="ä¸€é”®æ™ºèƒ½åŒ¹é…æ•°æ®"
                  supertip="è‡ªåŠ¨è¯†åˆ«åŒ¹é…å­—æ®µï¼Œå¿«é€Ÿå®Œæˆæ•°æ®å…³è”"/>

          <button id="VlookupWizardBtn"
                  label="VLOOKUPå‘å¯¼"
                  size="large"
                  image="VlookupWizard"
                  onAction="OnVlookupWizard"
                  screentip="VLOOKUPåˆ†æ­¥å‘å¯¼"
                  supertip="ä¸æ‡‚å‡½æ•°ï¼Ÿè·Ÿç€å‘å¯¼ä¸€æ­¥æ­¥å®Œæˆæ•°æ®åŒ¹é…"/>

          <menu id="MatchTemplatesMenu"
                label="åŒ¹é…æ¨¡æ¿"
                size="large"
                image="Templates">
            <button id="OrderMatchBtn" label="è®¢å•åŒ¹é…" onAction="OnOrderMatch"/>
            <button id="EmployeeMatchBtn" label="å‘˜å·¥ä¿¡æ¯" onAction="OnEmployeeMatch"/>
            <button id="FinanceMatchBtn" label="è´¢åŠ¡å¯¹è´¦" onAction="OnFinanceMatch"/>
            <button id="InventoryMatchBtn" label="åº“å­˜ç›˜ç‚¹" onAction="OnInventoryMatch"/>
          </menu>
        </group>

        <!-- è¡¨æ ¼ç¾åŒ–ç»„ -->
        <group id="BeautifyGroup" label="ä¸€é”®ç¾åŒ–">
          <button id="SmartBeautifyBtn"
                  label="æ™ºèƒ½ç¾åŒ–"
                  size="large"
                  image="SmartBeautify"
                  onAction="OnSmartBeautify"
                  screentip="ä¸€é”®æ™ºèƒ½ç¾åŒ–è¡¨æ ¼"
                  supertip="è‡ªåŠ¨è¯†åˆ«è¡¨æ ¼ç±»å‹ï¼Œåº”ç”¨æœ€åˆé€‚çš„ç¾åŒ–æ ·å¼"/>

          <gallery id="TemplateGallery"
                   label="ç¾åŒ–æ¨¡æ¿"
                   size="large"
                   image="TemplateGallery"
                   columns="3"
                   rows="2"
                   onAction="OnApplyTemplate">
            <item id="Classic" image="ClassicTemplate" label="ç»å…¸è“"/>
            <item id="Modern" image="ModernTemplate" label="ç°ä»£å½©è™¹"/>
            <item id="Business" image="BusinessTemplate" label="å•†åŠ¡ç°"/>
            <item id="Data" image="DataTemplate" label="æ•°æ®è¡¨"/>
            <item id="Fresh" image="FreshTemplate" label="æ¸…æ–°ç»¿"/>
            <item id="Energy" image="EnergyTemplate" label="æ´»åŠ›æ©™"/>
          </gallery>

          <menu id="QuickStyleMenu"
                label="å¿«æ·æ ·å¼"
                size="normal">
            <button id="AutoFitBtn" label="è‡ªé€‚åº”åˆ—å®½" onAction="OnAutoFit"/>
            <button id="AlternateColorBtn" label="éš”è¡Œæ¢è‰²" onAction="OnAlternateColor"/>
            <button id="HeaderStyleBtn" label="æ ‡é¢˜ç¾åŒ–" onAction="OnHeaderStyle"/>
            <button id="NumberFormatBtn" label="æ•°å­—æ ¼å¼" onAction="OnNumberFormat"/>
            <button id="FreezePanesBtn" label="å†»ç»“é¦–è¡Œ" onAction="OnFreezePanes"/>
            <button id="ClearFormatBtn" label="æ¸…é™¤æ ¼å¼" onAction="OnClearFormat"/>
          </menu>
        </group>

        <!-- æ–‡æœ¬å¤„ç†ç»„ -->
        <group id="TextToolsGroup" label="æ–‡æœ¬å¤„ç†">
          <menu id="CaseMenu"
                label="å¤§å°å†™"
                size="normal"
                image="TextCase">
            <button id="UpperBtn" label="å…¨éƒ¨å¤§å†™" onAction="OnUpperCase"/>
            <button id="LowerBtn" label="å…¨éƒ¨å°å†™" onAction="OnLowerCase"/>
            <button id="ProperBtn" label="é¦–å­—æ¯å¤§å†™" onAction="OnProperCase"/>
          </menu>

          <menu id="ExtractMenu"
                label="æå–å·¥å…·"
                size="normal"
                image="Extract">
            <button id="ExtractNumberBtn" label="æå–æ•°å­—" onAction="OnExtractNumbers"/>
            <button id="ExtractLetterBtn" label="æå–å­—æ¯" onAction="OnExtractLetters"/>
            <button id="ExtractEmailBtn" label="æå–é‚®ç®±" onAction="OnExtractEmail"/>
            <button id="ExtractPhoneBtn" label="æå–æ‰‹æœºå·" onAction="OnExtractPhone"/>
          </menu>

          <button id="BatchReplaceBtn"
                  label="æ‰¹é‡æ›¿æ¢"
                  size="normal"
                  image="Replace"
                  onAction="OnBatchReplace"/>

          <button id="SplitColumnBtn"
                  label="æ‹†åˆ†åˆ—"
                  size="normal"
                  image="Split"
                  onAction="OnSplitColumn"/>
        </group>

        <!-- å¸®åŠ©ç»„ -->
        <group id="HelpGroup" label="å¸®åŠ©">
          <button id="GuidesBtn"
                  label="æ–°æ‰‹æŒ‡å—"
                  size="large"
                  image="Guide"
                  onAction="OnShowGuide"/>

          <button id="TipsBtn"
                  label="ä½¿ç”¨æŠ€å·§"
                  size="normal"
                  image="Tips"
                  onAction="OnShowTips"/>

          <button id="SettingsBtn"
                  label="è®¾ç½®"
                  size="normal"
                  image="Settings"
                  onAction="OnShowSettings"/>
        </group>

      </tab>
    </tabs>
  </ribbon>
</customUI>
```

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
ExcelEfficiencyAssistant.VSTO/
â”‚
â”œâ”€â”€ ThisAddIn.cs                    # æ’ä»¶ä¸»å…¥å£
â”‚
â”œâ”€â”€ Ribbon/                          # åŠŸèƒ½åŒºUI
â”‚   â”œâ”€â”€ EfficiencyRibbon.xml        # Ribbon XMLå®šä¹‰
â”‚   â”œâ”€â”€ EfficiencyRibbon.cs         # Ribbonäº‹ä»¶å¤„ç†
â”‚   â””â”€â”€ Resources/                   # å›¾æ ‡èµ„æº
â”‚       â”œâ”€â”€ Icons/
â”‚       â””â”€â”€ TemplatePreview/
â”‚
â”œâ”€â”€ UI/                              # ç”¨æˆ·ç•Œé¢
â”‚   â”œâ”€â”€ TaskPanes/                   # ä»»åŠ¡çª—æ ¼
â”‚   â”‚   â”œâ”€â”€ DataMatcherPane.cs
â”‚   â”‚   â”œâ”€â”€ BeautifierPane.cs
â”‚   â”‚   â””â”€â”€ TextToolsPane.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Dialogs/                     # å¯¹è¯æ¡†
â”‚   â”‚   â”œâ”€â”€ VlookupWizardDialog.cs
â”‚   â”‚   â”œâ”€â”€ TemplateGalleryDialog.cs
â”‚   â”‚   â””â”€â”€ BatchReplaceDialog.cs
â”‚   â”‚
â”‚   â””â”€â”€ Controls/                    # è‡ªå®šä¹‰æ§ä»¶
â”‚       â”œâ”€â”€ PreviewPanel.cs
â”‚       â”œâ”€â”€ ProgressDialog.cs
â”‚       â””â”€â”€ HelpPanel.cs
â”‚
â”œâ”€â”€ Core/                            # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ DataMatcher/
â”‚   â”‚   â”œâ”€â”€ DataMatcherEngine.cs
â”‚   â”‚   â”œâ”€â”€ SmartColumnDetector.cs
â”‚   â”‚   â””â”€â”€ MatchIndexBuilder.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Beautifier/
â”‚   â”‚   â”œâ”€â”€ TableBeautifier.cs
â”‚   â”‚   â”œâ”€â”€ TemplateManager.cs
â”‚   â”‚   â””â”€â”€ StyleApplicator.cs
â”‚   â”‚
â”‚   â””â”€â”€ TextProcessor/
â”‚       â”œâ”€â”€ TextProcessor.cs
â”‚       â”œâ”€â”€ TextTransformer.cs
â”‚       â””â”€â”€ PatternExtractor.cs
â”‚
â”œâ”€â”€ Services/                        # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ SettingsManager.cs          # è®¾ç½®ç®¡ç†
â”‚   â”œâ”€â”€ HistoryManager.cs           # å†å²è®°å½•
â”‚   â”œâ”€â”€ TemplateManager.cs          # æ¨¡æ¿ç®¡ç†
â”‚   â””â”€â”€ LogService.cs               # æ—¥å¿—æœåŠ¡
â”‚
â”œâ”€â”€ Data/                            # æ•°æ®å±‚
â”‚   â”œâ”€â”€ Database/
â”‚   â”‚   â”œâ”€â”€ AppDbContext.cs         # EF Coreä¸Šä¸‹æ–‡
â”‚   â”‚   â””â”€â”€ Migrations/
â”‚   â”‚
â”‚   â”œâ”€â”€ Repositories/
â”‚   â”‚   â”œâ”€â”€ TemplateRepository.cs
â”‚   â”‚   â””â”€â”€ HistoryRepository.cs
â”‚   â”‚
â”‚   â””â”€â”€ Models/
â”‚       â”œâ”€â”€ Template.cs
â”‚       â”œâ”€â”€ MatchConfig.cs
â”‚       â””â”€â”€ OperationHistory.cs
â”‚
â”œâ”€â”€ Helpers/                         # è¾…åŠ©å·¥å…·
â”‚   â”œâ”€â”€ ExcelHelper.cs              # Excelæ“ä½œå¸®åŠ©ç±»
â”‚   â”œâ”€â”€ ValidationHelper.cs         # éªŒè¯å¸®åŠ©ç±»
â”‚   â””â”€â”€ PerformanceHelper.cs        # æ€§èƒ½ä¼˜åŒ–å¸®åŠ©ç±»
â”‚
â”œâ”€â”€ Resources/                       # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ Templates/                   # ç¾åŒ–æ¨¡æ¿
â”‚   â”œâ”€â”€ Guides/                      # å¸®åŠ©æ–‡æ¡£
â”‚   â””â”€â”€ Localization/               # æœ¬åœ°åŒ–èµ„æº
â”‚
â””â”€â”€ Properties/
    â”œâ”€â”€ AssemblyInfo.cs
    â””â”€â”€ Settings.settings
```

## ğŸ”§ ä¾èµ–åŒ…

```xml
<packages>
  <!-- Office äº’æ“ä½œ -->
  <package id="Microsoft.Office.Interop.Excel" version="15.0.0" />
  <package id="Microsoft.Office.Tools.Excel" version="10.0.0" />

  <!-- æ•°æ®åº“ -->
  <package id="Microsoft.EntityFrameworkCore.Sqlite" version="7.0.0" />

  <!-- UIæ¡†æ¶ -->
  <package id="System.Windows.Forms" version="7.0.0" />
  <package id="DevExpress.WindowsForms" version="23.1.0" />

  <!-- å·¥å…·åº“ -->
  <package id="Newtonsoft.Json" version="13.0.3" />
  <package id="AutoMapper" version="12.0.1" />
  <package id="Serilog" version="3.0.0" />
</packages>
```

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æ‰¹é‡æ“ä½œä¼˜åŒ–
```csharp
// âŒ æ…¢ï¼šé€ä¸ªå•å…ƒæ ¼æ“ä½œ
for (int row = 1; row <= 10000; row++)
{
    worksheet.Cells[row, 1].Value = "data";  // 10000æ¬¡COMè°ƒç”¨
}

// âœ… å¿«ï¼šæ•°ç»„æ‰¹é‡æ“ä½œ
object[,] data = new object[10000, 1];
for (int i = 0; i < 10000; i++)
{
    data[i, 0] = "data";
}
worksheet.Range["A1:A10000"].Value2 = data;  // 1æ¬¡COMè°ƒç”¨
```

### 2. å±å¹•æ›´æ–°æ§åˆ¶
```csharp
app.ScreenUpdating = false;
app.Calculation = Excel.XlCalculation.xlCalculationManual;
try
{
    // æ‰§è¡Œå¤§é‡æ“ä½œ
}
finally
{
    app.Calculation = Excel.XlCalculation.xlCalculationAutomatic;
    app.ScreenUpdating = true;
}
```

### 3. å¹¶è¡Œå¤„ç†
```csharp
Parallel.For(0, rowCount, new ParallelOptions
{
    MaxDegreeOfParallelism = Environment.ProcessorCount
}, row =>
{
    // æ•°æ®å¤„ç†é€»è¾‘
});
```

## ğŸ“Š æ•°æ®åº“è®¾è®¡

```sql
-- æ¨¡æ¿è¡¨
CREATE TABLE Templates (
    Id INTEGER PRIMARY KEY AUTOINCREMENT,
    Name TEXT NOT NULL,
    DisplayName TEXT NOT NULL,
    Category TEXT NOT NULL,
    JsonConfig TEXT NOT NULL,
    PreviewImage BLOB,
    IsBuiltIn INTEGER DEFAULT 0,
    UsageCount INTEGER DEFAULT 0,
    CreatedAt TEXT NOT NULL,
    UpdatedAt TEXT NOT NULL
);

-- æ“ä½œå†å²è¡¨
CREATE TABLE OperationHistory (
    Id INTEGER PRIMARY KEY AUTOINCREMENT,
    OperationType TEXT NOT NULL,  -- Match, Beautify, TextProcess
    ConfigJson TEXT NOT NULL,
    RowsProcessed INTEGER,
    Duration INTEGER,  -- æ¯«ç§’
    Success INTEGER DEFAULT 1,
    ErrorMessage TEXT,
    CreatedAt TEXT NOT NULL
);

-- ç”¨æˆ·è®¾ç½®è¡¨
CREATE TABLE UserSettings (
    Key TEXT PRIMARY KEY,
    Value TEXT NOT NULL,
    UpdatedAt TEXT NOT NULL
);
```

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç¯å¢ƒå‡†å¤‡**
   - å®‰è£… Visual Studio 2022
   - å®‰è£… Office/SharePoint å¼€å‘å·¥å…·
   - é…ç½®å¼€å‘è¯ä¹¦

2. **é¡¹ç›®åˆå§‹åŒ–**
   - åˆ›å»º VSTO Excel Add-in é¡¹ç›®
   - é…ç½®é¡¹ç›®ç»“æ„
   - æ·»åŠ å¿…è¦çš„ NuGet åŒ…

3. **æ ¸å¿ƒåŠŸèƒ½å¼€å‘**
   - å…ˆå®ç°æ•°æ®åŒ¹é…å¼•æ“
   - å†å®ç°è¡¨æ ¼ç¾åŒ–
   - æœ€åå®ç°æ–‡æœ¬å¤„ç†

4. **UIå¼€å‘**
   - è®¾è®¡ Ribbon ç•Œé¢
   - å¼€å‘ä»»åŠ¡çª—æ ¼
   - åˆ›å»ºå‘å¯¼å¯¹è¯æ¡†

5. **æµ‹è¯•ä¸ä¼˜åŒ–**
   - åŠŸèƒ½æµ‹è¯•
   - æ€§èƒ½ä¼˜åŒ–
   - ç”¨æˆ·ä½“éªŒä¼˜åŒ–

6. **æ‰“åŒ…å‘å¸ƒ**
   - åˆ›å»ºå®‰è£…ç¨‹åº
   - æ•°å­—ç­¾å
   - ç¼–å†™æ–‡æ¡£
